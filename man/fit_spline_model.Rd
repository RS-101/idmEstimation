% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_pen.R
\name{fit_spline_model}
\alias{fit_spline_model}
\title{Fit Penalized Spline Model for Illness-Death Data}
\usage{
fit_spline_model(
  data,
  knots_12 = NULL,
  knots_13 = NULL,
  knots_23 = NULL,
  degree = 3,
  n_knots = 7,
  kappa_12 = NULL,
  kappa_13 = NULL,
  kappa_23 = NULL,
  verbose = TRUE,
  run_in_parallel = FALSE,
  ...
)
}
\arguments{
\item{data}{Data frame with observed illness-death data (see \code{\link{fit_npmle}}
for required columns).}

\item{knots_12}{Numeric vector of knot positions for 1→2 transition. If \code{NULL},
created automatically. Default is \code{NULL}.}

\item{knots_13}{Numeric vector of knot positions for 1→3 transition. Default is \code{NULL}.}

\item{knots_23}{Numeric vector of knot positions for 2→3 transition. Default is \code{NULL}.}

\item{degree}{Integer. Degree of the M-spline basis. Default is 3 (cubic).}

\item{n_knots}{Integer. Number of knots if not specified. Default is 7.}

\item{kappa_12}{Numeric vector of smoothing parameters to try for 1→2. If \code{NULL},
uses a logarithmic grid from 0.01 to 1e20. Default is \code{NULL}.}

\item{kappa_13}{Numeric vector of smoothing parameters for 1→3. Default is \code{NULL}.}

\item{kappa_23}{Numeric vector of smoothing parameters for 2→3. Default is \code{NULL}.}

\item{verbose}{Logical. If \code{TRUE}, prints progress during cross-validation.
Default is \code{TRUE}.}

\item{run_in_parallel}{Logical. If \code{TRUE}, evaluates smoothing parameter grid
in parallel using \code{\link[parallel]{mclapply}}. Default is \code{FALSE}.}

\item{...}{Additional arguments passed to \code{\link[stats]{optim}}.}
}
\value{
An object of class \code{"idm_object"} containing:
\describe{
\item{estimators}{Smooth hazard, cumulative hazard, and distribution functions}
\item{data}{Original input data}
\item{model_type}{Character: \code{"penalized_spline"}}
\item{raw_estimates}{Spline coefficients (theta vectors)}
\item{model_config}{Knots, degree, and basis configuration}
\item{converged}{Logical indicating optimization convergence}
\item{model_specific}{Selected smoothing parameters, cross-validation results}
}
}
\description{
Estimates smooth transition hazards using penalized M-splines with automatic
smoothing parameter selection via approximate cross-validation.
}
\details{
The model maximizes a penalized log-likelihood:
\deqn{\ell(\theta) - \kappa \int [h''(t)]^2 dt}
where \eqn{h(t)} is the hazard function and \eqn{\kappa} controls smoothness.

Larger \eqn{\kappa} produces smoother fits; smaller values allow more flexibility.
The function searches over a grid of \eqn{\kappa} values and selects the one
maximizing an approximate cross-validation criterion.

M-splines are non-negative and integrate to I-splines, making them ideal for
hazard modeling. The penalty is computed via numerical integration of the
second derivative.
}
\examples{
\donttest{
# Simulate data with time-varying hazards
set.seed(567)
sim_data <- simulate_idm_weibull(n = 400, shape12 = 2.5, shape23 = 1.8)

# Fit penalized spline model (may take a minute)
fit_spline <- fit_spline_model(
  sim_data$data,
  degree = 3,
  n_knots = 8,
  verbose = FALSE
)

# Check selected smoothing parameters
fit_spline$model_specific$final_kappas

# Plot smooth hazard estimates
plot(fit_spline)
}

}
\references{
Ramsay, J. O. (1988). Monotone regression splines in action.
\emph{Statistical Science}, 3(4), 425-441.
}
\seealso{
\code{\link{fit_pc_model}}, \code{\link{fit_npmle}}
}
